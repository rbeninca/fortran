<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>GFIG üöÄ - Balan√ßa Wi-Fi</title>

  <link rel="stylesheet" href="/chartist.min.css">
  <script src="/chartist.min.js"></script>
  <script src="script.js" defer></script>
  <script src="script_grafico_sessao.js" defer></script>

  <style>
    :root {
      --cor-fundo: #f3f4f6;
      --cor-texto: #1f2937;
      --cor-texto-secundario: #6b7280;
      --cor-primaria: #570df8;
      --cor-primaria-hover: #4506cb;
      --cor-sucesso: #22c55e;
      --cor-erro: #ef4444;
      --cor-aviso: #f59e0b;
      --cor-info: #3b82f6;
      --cor-borda: #e5e7eb;
      --cor-fundo-card: #ffffff
    }

    body {
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
      background-color: var(--cor-fundo);
      color: var(--cor-texto);
      line-height: 1.5
    }

    * {
      box-sizing: border-box
    }

    .container {
      max-width:100vw;
      margin: 0 auto;
      padding: 1rem
    }

    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: .5rem
    }

    header h1 {
      font-size: 1.875rem;
      font-weight: 700;
      color: #374151;
      margin: 0
    }

    .status-conexao {
      display: flex;
      align-items: center;
      gap: .5rem
    }

    #ws-indicator {
      width: 1rem;
      height: 1rem;
      border-radius: 9999px;
      background-color: var(--cor-erro);
      transition: background-color .5s
    }

    #ws-indicator.conectado {
      background-color: var(--cor-sucesso)
    }

    #balanca-status-line {

      text-align: center;
      font-weight: 600;
      margin-bottom: 1rem;
      padding: .5rem;
      background-color: #c8cbd2;
      border-radius: .5rem
    }

    #balanca-status {
      color: var(--cor-primaria)
    }

    .nav-abas {
      margin-bottom: 1rem;
      border-bottom: 1px solid var(--cor-borda)
    }

    .nav-abas nav {
      display: flex;
      gap: 1.5rem;
      flex-wrap: wrap
    }

    .tablink {
      padding: 1rem .25rem;
      border: 2px solid transparent;
      background: none;
      font-weight: 500;
      font-size: .875rem;
      cursor: pointer;
      color: var(--cor-texto-secundario)
    }

    .tablink.active {
      border-color: var(--cor-primaria);
      color: var(--cor-primaria)
    }

    .tabcontent {
      display: none;
      background-color: var(--cor-fundo-card);
      padding: 1.5rem;
      border-radius: .5rem;
      box-shadow: 0 1px 3px 0 rgba(0, 0, 0, .1);
      animation: fadeIn .5s
    }

    .tabcontent.active {
      display: block
    }

    @keyframes fadeIn {
      from {
        opacity: 0
      }

      to {
        opacity: 1
      }
    }

    .btn {
      padding: .5rem 1rem;
      font-size: .875rem;
      font-weight: 700;
      border: 1px solid transparent;
      border-radius: .5rem;
      cursor: pointer;
      box-shadow: 0 1px 2px 0 rgba(0, 0, 0, .05);
      transition: background-color .2s, opacity .2s;
    }
    
    .btn:disabled {
        opacity: 0.5;
        cursor: not-allowed;
    }

    .btn-grupo {
      display: inline-flex;
      border-radius: .5rem;
      box-shadow: 0 1px 2px 0 rgba(0, 0, 0, .05)
    }

    .btn-grupo .btn {
      border-radius: 0;
      box-shadow: none;
      border: 1px solid var(--cor-borda)
    }

    .btn-grupo .btn:first-child {
      border-radius: .5rem 0 0 .5rem
    }

    .btn-grupo .btn:last-child {
      border-radius: 0 .5rem .5rem 0
    }

    .btn-grupo .btn:not(:first-child) {
      border-left: 0
    }

    .btn-grupo .btn.ativo {
      background-color: var(--cor-primaria);
      color: #fff;
      border-color: var(--cor-primaria)
    }

    .btn-primario {
      background-color: var(--cor-primaria);
      color: #fff
    }

    .btn-primario:hover {
      background-color: var(--cor-primaria-hover)
    }

    .btn-perigo {
      background-color: var(--cor-erro);
      color: #fff
    }

    .btn-perigo:hover {
      background-color: #d73737
    }

    .btn-aviso {
      background-color: var(--cor-aviso);
      color: #fff
    }

    .btn-aviso:hover {
      background-color: #f68a0a
    }

    .btn-sucesso {
      background-color: var(--cor-sucesso);
      color: #fff
    }

    .btn-sucesso:hover {
      background-color: #16a34a
    }

    .btn-secundario {
      background-color: #6b7280;
      color: #fff
    }

    .btn-secundario:hover {
      background-color: #4b5563
    }

    .btn-indigo {
      background-color: #6366f1;
      color: #fff
    }

    .btn-indigo:hover {
      background-color: #4f46e5
    }

    input[type=text],
    input[type=password],
    input[type=number] {
      padding: .5rem .75rem;
      border: 1px solid #d1d5db;
      border-radius: .375rem;
      width: 100%
    }
    
    input:disabled {
        background-color: #f3f4f6;
        cursor: not-allowed;
    }

    label {
      display: block;
      font-weight: 500;
      margin-bottom: .25rem
    }

    .grid-container {
      display: grid;
      gap: 1.5rem
    }

    @media (min-width:768px) {
      .grid-container {
        grid-template-columns: repeat(2, minmax(0, 1fr))
      }
    }

    .flex-center {
      display: flex;
      justify-content: center;
      align-items: center;
      flex-wrap: wrap;
      gap: 1rem
    }

    .leituras-display {
      display: flex;
      justify-content: space-around;
      text-align: center;
      margin-bottom: 1.5rem;
      padding: 1rem;
      background-color: #f9fafb;
      border-radius: .5rem;
      box-shadow: inset 0 2px 4px 0 rgba(0, 0, 0, .05)
    }

    .leituras-display h4 {
      margin: 0;
      font-size: .875rem;
      font-weight: 500;
      color: var(--cor-texto-secundario);
      text-transform: uppercase
    }

    .leituras-display p {
      margin: 0;
      font-size: 1.875rem;
      font-weight: 700
    }

    #forca-atual {
      color: var(--cor-primaria)
    }

    #forca-maxima {
      color: var(--cor-erro)
    }

    .tabela-container {
      overflow-y: auto;
      max-height: 40rem
    }

    table {
      width: 100%;
      border-collapse: collapse
    }

    th,
    td {
      padding: .75rem 1rem;
      text-align: left;
      border-bottom: 1px solid var(--cor-borda)
    }

    thead {
      background-color: #f9fafb;
      position: sticky;
      top: 0
    }

    th {
      font-size: .75rem;
      font-weight: 500;
      color: var(--cor-texto-secundario);
      text-transform: uppercase
    }

    #notification-area {
      position: fixed;
      top: 1rem;
      right: 1rem;
      z-index: 1000;
      width: 320px;
    }

    .notificacao {
      padding: 1rem;
      margin-bottom: .5rem;
      border-left-width: 4px;
      border-radius: .375rem;
      box-shadow: 0 4px 6px -1px rgba(0,0,0,.1), 0 2px 4px -2px rgba(0,0,0,.1);
    }

    .notificacao p {
      margin: 0
    }

    .notificacao .titulo {
      font-weight: 700
    }

    .notificacao.sucesso {
      border-color: var(--cor-sucesso);
      background-color: #f0fdf4;
      color: #15803d
    }

    .notificacao.erro {
      border-color: var(--cor-erro);
      background-color: #fef2f2;
      color: #b91c1c
    }

    .notificacao.info {
      border-color: var(--cor-info);
      background-color: #eff6ff;
      color: #1d4ed8
    }

    .card-gravacao {
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      justify-content: space-between;
      padding: 1rem;
      border: 1px solid var(--cor-borda);
      border-radius: .5rem;
      gap: .5rem
    }

    @media (min-width:640px) {
      .card-gravacao {
        flex-direction: row;
        align-items: center
      }
    }

    .card-gravacao .botoes {
      display: flex;
      flex-wrap: wrap;
      gap: .5rem
    }
    #grafico {
      height: 50vh; /* 60% da altura da viewport */
    }

    .ct-chart .ct-series.ct-series-a .ct-line {
      stroke: var(--cor-primaria);
      stroke-width: 2px;
    }

    .ct-chart .ct-series.ct-series-a .ct-point {
      stroke: var(--cor-primaria);
      stroke-width: 5px;
    }

    .ct-chart .ct-grid {
      stroke: rgba(0, 0, 0, 0.1);
    }

    .ct-chart .ct-label {
      fill: rgba(0, 0, 0, 0.4);
      color: rgba(0, 0, 0, 0.4);
      font-size: 0.75rem;
    }

    .ct-label.ct-horizontal.ct-end {
      transform: rotate(90deg);
      transform-origin: left center;
      font-size: 8pt;
      text-anchor: start;
    }
  </style>
</head>

<body>
  <div class="container">
    <header>
      <h1>GFIG üöÄ - Balan√ßa Wi-Fi</h1>
      <div class="status-conexao">
        <div id="ws-indicator" title="Desconectado"></div><span id="ws-text">Desconectado</span>
      </div>
    </header>
    <div id="balanca-status-line">Status da Balan√ßa: <span id="balanca-status">...</span></div>
    <div class="flex-center" style="margin-bottom: 1rem;">
      <div class="btn-grupo" role="group"><button id="btn-unit-n" class="btn" onclick="setDisplayUnit('N')">Newtons
          (N)</button><button id="btn-unit-gf" class="btn" onclick="setDisplayUnit('gf')">Grama-for√ßa
          (gf)</button><button id="btn-unit-kgf" class="btn" onclick="setDisplayUnit('kgf')">Quilo-for√ßa (kgf)</button>
      </div>
    </div>

    <div style="position: sticky; top:-10px; z-index: 10;" class="leituras-display">
      <div>
        <h4>For√ßa Atual</h4>
        <p id="forca-atual">---</p>
      </div>
      <div>
        <h4>For√ßa EMS</h4>
        <p id="forca-ems">---</p>
      </div>
      <div>
        <h4>For√ßa M√°xima</h4>
        <p id="forca-maxima">---</p>
        <small id="forca-minima" style="display: block; font-size: 0.75rem; color: var(--cor-texto-secundario);">m√≠n:
          ---</small>
      </div>
      <div>
        <h4>Leituras/Seg</h4>
        <p id="leituras-por-segundo">---</p>
      </div>
    </div>

    <div style="position: sticky; top:3rem; z-index: 10;" class="nav-abas">
      <nav><button class="tablink" onclick="abrirAba(this, 'abaGrafico')" id="padrao">üìà Gr√°fico</button><button
          class="tablink" onclick="abrirAba(this, 'abaTabela')">üìã Tabela</button><button class="tablink"
          onclick="abrirAba(this, 'abaGravacoes')">üíæ Grava√ß√µes</button><button class="tablink"
          onclick="abrirAba(this, 'abaControles')">‚öôÔ∏è Par√¢metros</button><button class="tablink"
          onclick="abrirAba(this, 'abaConfig')">üì° Rede Wi-Fi</button>
      </nav>
    </div>
    <main>
      <div id="abaGrafico" class="tabcontent">

        <div class="flex-center" style="margin-bottom: 1rem; flex-direction: column; gap: 1rem;">
          <!-- Controles de Sess√£o -->
          <div style="display: flex; align-items: center; gap: 0.5rem; padding: 0.5rem; border: 1px solid var(--cor-borda); border-radius: 0.5rem;">
            <input type="text" id="nome-sessao" placeholder="Nome da Sess√£o...">
            <button id="btn-iniciar-sessao" onclick="iniciarSessao()" class="btn btn-sucesso">‚ñ∂ Iniciar</button>
            <button id="btn-encerrar-sessao" onclick="encerrarSessao()" class="btn btn-perigo" disabled>‚èπ Encerrar e Salvar</button>
          </div>
          <!-- Controles do Gr√°fico -->
          <div class="btn-grupo">
            <button id="btn-deslizante" class="btn" onclick="setChartMode('deslizante')">Deslizante</button>
            <button id="btn-acumulado" class="btn" onclick="setChartMode('acumulado')">Acumulado</button>
            <button id="btn-pausado" class="btn" onclick="setChartMode('pausado')">Pausar Gr√°fico</button>
            <button id="btn-anti-noising" class="btn" onclick="toggleAntiNoising()">Anti-Noising: Off</button>
            <button onclick="clearChart()" class="btn btn-secundario">Limpar Gr√°fico</button>
          </div>
        </div>
        
        <div id="grafico" class="ct-chart ct-golden-section"></div>
      </div>
  </div>
  <div id="abaTabela" class="tabcontent">
    <div class="tabela-container">
      <table id="tabela">
        <thead>
          <tr>
            <th>Data e Hora</th>
            <th>Tempo ESP (s)</th>
            <th>Newtons (N)</th>
            <th>Grama-for√ßa (gf)</th>
            <th>Quilo-for√ßa (kgf)</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </div>
  <div id="abaControles" class="tabcontent">
    <section>
      <h2 style="font-size: 1.25rem; font-weight: 600; margin-bottom: 0.5rem;">Par√¢metros da Balan√ßa</h2>
      <p style="font-size: 0.875rem; color: var(--cor-texto-secundario); margin-bottom: 1rem;">Estes s√£o os valores
        atuais em uso.</p>
      <div class="grid-container" style="gap: 1rem;">
        <div><label for="param-conversao">Fator de Convers√£o</label><input id="param-conversao" type="number"
            step="any"></div>
        <div><label for="param-gravidade">Gravidade (m/s¬≤)</label><input id="param-gravidade" type="number" step="any">
        </div>
        <div><label for="param-offset">Offset de Tara Salvo</label><input id="param-offset"
            style="padding: 0.5rem 0.75rem; background-color: #f9fafb; border: 1px solid #d1d5db; border-radius: 0.375rem;" readonly></input>
        </div>
      </div>
      <h3 style="font-size: 1.125rem; font-weight: 600; margin-top: 1.5rem; margin-bottom: 0.5rem;">Par√¢metros de
        Estabiliza√ß√£o</h3>
      <div class="grid-container" style="gap: 1rem;">
        <div><label for="param-leituras-estaveis">Leituras Est√°veis</label><input id="param-leituras-estaveis"
            type="number"></div>
        <div><label for="param-tolerancia">Toler√¢ncia de Estabilidade</label><input id="param-tolerancia" type="number"
            step="any" oninput="atualizarToleranciaEmGramas()"">  
              <small id="tolerancia-em-gramas"
            style="color: var(--cor-texto-secundario); display: block; margin-top: 0.25rem;">‚âà 0.00 g</small></div>
        <div><label for="param-num-amostras">N¬∫ Amostras para M√©dia</label><input id="param-num-amostras" type="number">
        </div>
        <div><label for="param-timeout">Timeout de Calibra√ß√£o (ms)</label><input id="param-timeout" type="number"></div>
      </div>
      <button onclick="salvarParametros()" class="btn btn-sucesso" style="margin-top: 1.5rem;">Salvar Todos os
        Par√¢metros</button>
    </section>
    <div style="margin-top: 2rem; padding-top: 1.5rem; border-top: 1px solid var(--cor-borda);">
      <div class="grid-container">
        <div>
          <h3>Comando de Tara</h3>
          <p style="font-size: 0.875rem; color: var(--cor-texto-secundario); margin-bottom: 0.75rem;">Zera a balan√ßa.
            Use com o prato vazio.</p><button onclick="tare()" class="btn btn-primario">Zerar (Tara)</button>
        </div>
        <div>
          <h3>Calibra√ß√£o</h3>
          <p style="font-size: 0.875rem; color: var(--cor-texto-secundario); margin-bottom: 0.75rem;">Coloque um peso de
            massa conhecida (em gramas) e digite o valor.</p>
          <div style="display: flex; align-items: center; gap: 0.5rem;"><input id="massaCalibracao" type="number"
              step="any" placeholder="Massa em gramas" style="width: 12rem;"><button onclick="calibrar()"
              class="btn btn-aviso">Calibrar</button></div>
        </div>
      </div>
    </div>
  </div>
  <div id="abaGravacoes" class="tabcontent">
    <h2 style="font-size: 1.25rem; font-weight: 600; margin-bottom: 0.5rem;">Grava√ß√µes Salvas</h2>
    <p style="font-size: 0.875rem; color: var(--cor-texto-secundario); margin-bottom: 1rem;">As grava√ß√µes s√£o salvas
      apenas neste navegador.</p>
    <div id="lista-gravacoes" style="display: flex; flex-direction: column; gap: 0.75rem;"></div>
  </div>
  <div id="abaConfig" class="tabcontent">
    <section>
      <h2 style="font-size: 1.25rem; font-weight: 600; margin-bottom: 1rem;">Configura√ß√£o da Rede Wi-Fi</h2>
      <form onsubmit="salvarRede(event)" style="display: flex; flex-direction: column; gap: 1rem;">
        <div><label for="ssid">Nome da Rede (SSID)</label><input id="ssid" required style="max-width: 320px;"></div>
        <div><label for="senha">Senha</label><input id="senha" type="password" style="max-width: 320px;"></div>
        <button type="submit" class="btn"
          style="background-color: #8b5cf6; color: white; align-self: flex-start;">Salvar Rede e Reiniciar</button>
      </form>
    </section>
  </div>
  <div id="notification-area"></div>
  </main>

  </div>

</body>
</html>
